# 分卷功能开发计划 (v0.5.0)

## 📋 功能列表

### Phase 1: 基础支持

#### 1.1 配置系统
- [x] 在 `novel.jsonc` 中新增 `volumes` 配置项
- [x] 支持启用/禁用分卷功能
- [x] 配置文件夹结构类型（flat/nested）
  - 配置文件需要给出详细注释告诉用户两者差别
- [x] 配置卷编号格式（阿拉伯数字/中文/罗马数字）

#### 1.2 文件夹识别
- [x] 自动检测 `chapters/` 下的子文件夹作为卷
- [x] 支持卷的命名规范：`第一卷-崛起` 或 `01-崛起` 或 `Volume1-Rising`
- [x] 解析卷序号和卷名称
- [x] 兼容无卷结构（扁平章节列表）
- [x] 配置章节编号模式（全局连续/按卷重置/混合模式）
- [ ] 自动更新章节 frontmatter 的 volume 字段
- [x] 卷的默认排序规则：
  - 前传卷 → 正文卷（按序号）→ 后传卷 → 番外卷
  - 同类型卷内部按序号排序

#### 1.3 侧边栏显示
- [x] 侧边栏按卷分组显示章节
- [x] 显示卷的折叠/展开状态
- [x] 显示每卷的统计信息：
  - 章节数量
  - 总字数
  - 完成章节数/总章节数
- [x] 卷的图标和视觉区分
- [x] 卷的状态图标（计划中📝 / 创作中✍️ / 已完成✅）

#### 1.4 统计功能
- [x] 计算每卷的总字数
- [x] 计算每卷的章节数量
- [x] 计算每卷的完成度
- [x] 在状态栏显示当前章节所属的卷信息

#### 1.5 功能集成
- [ ] 统计页面支持卷视图（修改 statsWebviewProvider.ts）
- [x] README 自动更新支持卷目录（修改 readmeUpdater.ts）

---

### Phase 2: 交互增强

#### 2.1 创建卷
- [x] 命令：`Noveler: 创建新卷` 或 点击菜单栏的创建卷icon
  - 可以放在章节列表章节管理里面，和原来的创建章节兼容
- [x] 支持快速创建卷（使用默认命名：第X卷）
- [ ] 创建卷时可选择从模板创建（预设章节结构）
- [x] 支持创建特殊类型的卷：
  - 正文卷（默认）
  - 前传卷（编号为负数或特殊标记，如"前传一"）
  - 后传卷（编号在正文后，如"后传一"）
  - 番外卷（独立编号系统，如"番外一"）
- [x] 输入卷序号
- [x] 输入卷名称
- [x] 可选输入卷描述
- [x] 自动创建卷文件夹
- [x] 自动创建卷大纲文件（可选）

#### 2.2 卷管理
- [x] 右键菜单：在卷上右键显示操作
  - 重命名卷
  - 删除卷（需确认）
  - 设置卷状态（计划中/创作中/已完成）
  - 编辑卷信息
  - 设置卷类型（正文/前传/后传/番外）
- [x] 重命名卷时自动更新：
  - 文件夹名称
  - volume.json 中的 title
  - 所有章节 frontmatter 的 volume 字段（如果使用名称而非序号）
- [x] 侧边栏卷操作按钮
  - 快速创建新章节到当前卷
  - 展开/折叠卷
- [ ] 卷的归档功能（已完成的卷可以归档）

#### 2.3 章节管理
- [x] 右键菜单：在章节上右键显示操作
  - 移动到其他卷
  - 复制到其他卷
- [x] 章节序号自动重新编号（移动到新卷后）
- [x] 在章节 frontmatter 中自动添加 volume 和 volumeType 字段

#### 2.4 结构迁移
- [x] 提供迁移向导（扁平章节 → 分卷结构）
  - 用户手动选择如何划分卷
  - 支持自定义划分
- [x] 回滚功能（取消分卷回到扁平结构）

---

### Phase 3: 元数据支持

#### 3.1 卷信息文件
- [x] 支持 `volume.json` 元数据文件
- [x] 字段定义：
  ```json
  {
    "volume": 1,
    "volumeType": "main",
    "title": "崛起",
    "subtitle": "副标题",
    "status": "completed",
    "targetWords": 100000,
    "description": "卷简介",
    "startDate": "2025-01-01",
    "endDate": "2025-03-15",
    "theme": "主题",
    "mainConflict": "核心冲突"
  }
  ```
  - volumeType 可选值：main（正文）、prequel（前传）、sequel（后传）、extra（番外）
- [x] 支持卷大纲文件 `outline.md`
- [ ] 卷的关键人物列表（关联到 characters 目录）


#### 3.4 卷大纲管理
- [x] 卷大纲的快速访问（侧边栏按钮/右键菜单"编辑卷大纲"）
- [ ] 大纲与章节的关联（大纲中的条目链接到对应章节）
- [ ] 大纲完成度追踪（大纲中的情节是否都已写完）

---

### Phase 4: 高级功能

#### 4.1 README 自动生成
- [ ] 自动生成分卷目录结构
- [ ] 每卷显示：
  - 状态、字数、进度、章节列表
  - 卷简介
  - 主题
  - 卷类型标识（正文/前传/后传/番外）
- [ ] 支持折叠/展开章节列表
- [ ] 支持自定义模板
- [ ] 支持生成卷的简介页（单独的 volume-summary.md）

#### 4.2 多卷并行写作
- [ ] 支持同时打开多个卷
- [ ] 分屏显示不同卷的章节
- [ ] 跨卷引用和链接

#### 4.4 模板系统
- [ ] 预设卷模板（保持现状即可，实现时再细化）
  - 三幕结构
  - 五卷结构
  - 自定义卷数
- [ ] 初始化项目时选择模板
- [ ] 一键创建标准化卷结构