# 更新日志

本项目的所有重要更改都将记录在此文件中。

格式基于 [Keep a Changelog](https://keepachangelog.com/zh-CN/1.0.0/)，
版本号遵循 [语义化版本](https://semver.org/lang/zh-CN/)。

## [0.3.0] - 2025-11-26

### 新增功能

#### 侧边栏智能刷新
- **创建文件自动刷新**：创建章节或人物后自动刷新侧边栏，立即显示新内容
- **保存文件实时更新**：保存 Markdown 文件时自动更新字数统计和状态
- **文件监控**：通过 FileSystemWatcher 监控 chapters/ 和 characters/ 目录，外部修改也能及时刷新

#### README 人物汇总
- **自动扫描人物**：扫描 characters/ 目录，解析人物 Front Matter 信息
- **分类展示**：按重要性分组展示（主角 > 重要配角 > 次要配角 > 路人）
- **详细信息**：显示人物性别图标（👨👩👤）和首次登场信息
- **智能更新**：创建章节/人物后可选择是否自动更新 README

#### 灵活配置
- **README 更新配置**：新增 `autoUpdateReadmeOnCreate` 配置项
  - `always` - 总是自动更新
  - `ask` - 每次询问（默认）
  - `never` - 从不自动更新

### 技术改进
- 新增 `ErrorHandler` 统一错误处理模块，支持不同严重级别（Error/Warning/Silent）
- 新增 `scanCharacters()` 函数，扫描并解析人物文件 Front Matter
- 优化 README 更新逻辑，使用正则表达式进行更健壮的标题匹配
- 优化人物排序算法，使用显式排序数组确保顺序正确
- 改进 `updateSection()` 和 `updateSectionToEnd()` 函数，修复内容重复问题

### Bug 修复
- 修复 README 更新时重复添加内容的问题（`updateSection` 搜索位置错误）
- 修复人物重要性排序不正确的问题（使用显式排序数组代替 `Object.entries`）
- 统一术语：将"次要角色"改为"次要配角"，保持一致性

### 文档更新
- 更新 CHANGELOG.md 记录 v0.3.0 所有新功能
- 更新 README.md 补充侧边栏刷新和人物汇总说明
- 更新路线图，将已完成功能标记为 ✅

## [0.2.0] - 2025-11-21

### 新增功能

#### 写作辅助
- **专注模式**：一键切换 VSCode Zen Mode，隐藏所有干扰元素，进入纯粹的写作环境
- **自动保存**：插件启动时自动检测并启用 VSCode 自动保存功能（1秒延迟），防止意外丢失内容

#### 侧边栏视图
- **项目概览**：实时显示总字数、章节数、人物数、完成进度等统计信息
- **快捷操作**：集中管理所有常用命令，无需通过命令面板调用
- **章节大纲**：以树状结构展示所有章节，显示状态图标和字数
- **人物管理**：集中查看和管理小说人物档案
- **智能刷新**：创建章节/人物时自动刷新侧边栏，保存文件时实时更新统计
- **文件监控**：通过 FileSystemWatcher 监控 chapters/ 和 characters/ 目录，外部修改也能及时刷新

#### README 自动管理
- **人物汇总**：README 中新增"人物设定"章节，自动扫描并分类展示人物（主角、重要配角、次要配角、路人）
- **智能更新**：创建章节/人物后可选择是否自动更新 README
- **灵活配置**：通过 `autoUpdateReadmeOnCreate` 配置控制更新行为（always/ask/never）

#### 配置增强
- **novel.json 集中配置**：所有插件配置现在都优先从 `novel.json` 读取
- **配置优先级**：novel.json（项目级） > VSCode Settings（全局） > 默认值

### 技术改进
- 新增 `ProjectStatsService` 服务，统计项目信息
- 新增 `NovelerViewProvider`，提供完整的侧边栏视图体验
- 新增 `ErrorHandler` 统一错误处理模块，支持不同严重级别
- 优化配置读取逻辑，支持更灵活的配置层级
- 新增 `scanCharacters()` 函数，扫描并解析人物文件 Front Matter
- 改进 README 更新逻辑，修复重复添加内容的问题
- 优化字符排序算法，确保人物按重要性正确排列

### 文档更新
- 更新 README.md 功能说明
- 更新 `docs/novel-json配置说明.md`

### 命令新增
- `Noveler: 切换专注模式` - 进入/退出 Zen Mode
- `Noveler: 刷新视图` - 刷新侧边栏视图

### Bug 修复
- 修复 README 更新时重复添加内容的问题（updateSection 搜索位置错误）
- 修复人物重要性排序不正确的问题（使用显式排序数组代替 Object.entries）
- 统一术语：将"次要角色"改为"次要配角"，保持一致性

## [0.1.0] - 2025-11-19

### 新增功能

#### 语法高亮
- 对话内容高亮：支持多种引号格式（「」、""、''等）
- 心理描写高亮：（）包裹的内容以斜体显示
- 人物名称高亮：自动读取 characters/ 目录和 novel.json 配置
- 省略号特殊标记：… 和 ... 的样式突出显示

#### 项目管理
- 初始化小说项目：一键创建标准项目结构
- 创建新章节：自动计算章节号，支持中文数字（一、十、百、千、万等）
- 创建人物文件：带有完整 Front Matter 的人物档案模板
- README 自动更新：扫描章节统计字数、完成度，自动更新项目 README

#### 字数统计
- 状态栏实时显示：当前文档字数统计
- 详细统计信息：总字数、中文字数、段落数、行数
- 自动排除元数据：Front Matter 和 HTML 注释不计入字数
- Front Matter 自动更新：保存时自动更新章节字数

#### 文档格式化
- 引号标准化：自动转换中英文引号为配置样式
- 标点规范化：统一中文标点符号
- 空格处理：删除中文之间多余空格
- 特殊符号统一：省略号（…）和破折号（——）

#### 配置系统
- 项目级配置：novel.json 支持项目独立配置
- 全局配置：VSCode 设置支持全局默认配置
- 模板系统：可自定义章节、人物、README 等模板
- 配置外置：默认配置抽离到 templates/ 目录便于维护

### 技术改进
- 模块化架构：代码按功能拆分为 commands/、utils/、types/ 等模块
- TypeScript 类型安全：完整的类型定义和接口
- Front Matter 处理：使用 gray-matter 库解析 YAML
- 错误处理优化：用户友好的错误提示信息
- 时间格式优化：统一使用可读格式（YYYY-MM-DD HH:mm:ss）
- 中文数字转换：支持任意大小数字转换（支持万、亿等大单位）

### 文档
- 完整的 README 文档
- Front Matter 字段说明
- 使用指南和示例
- 配置选项说明

### 已知限制
- 语法高亮仅在 Markdown 文件中生效
- 人物名称高亮需要在 novel.json 或 characters/ 中定义
- 格式化功能不影响 Front Matter 和注释内容

---

## [未来计划]

### v0.3.0
- 智能提示（人物、场景、对话）
- 人物关系图可视化
- 章节大纲树状视图
- 更丰富的语法高亮规则

### v0.4.0
- 时间线管理工具
- 导出功能（HTML、PDF、EPUB）
- 写作目标跟踪
- AI 写作助手集成
